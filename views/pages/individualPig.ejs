

    <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Individual Pig</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
  </head>
<style>
   .pagination {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
  }
  .pagination .arrow {
    cursor: pointer;
    margin: 0 0.5rem;
  }

.cough-data-no-data {
  background-color: #198754;
}
.flex-wrap-equal > [class*='col-']{
  display: flex;
  flex-direction: column;
}
.flex-wrap-equal > [class*='col-'] > * {
  flex-grow: 1;
}
.offcanvas{
  width: 15% !important;
}
@media screen and (max-width: 576px) {
  .offcanvas{
  width: 55% !important;
}
}
@media screen and (min-width: 576px) and (max-width: 768px) {
  .offcanvas{
  width: 45% !important;
}
}
@media screen and (min-width: 768px) and (max-width: 992px){
  .offcanvas{
  width: 35% !important;
}
}
/* Hide all tables by default */
 #weekly, #monthly, #yearly, #week2, #month2, #year2{
      display: none;
    }
    .card-text-left {
    text-align: left;
  }
</style>
<body class ="container-fluid" style="background-color: #dfffd7;">
  <nav class="navbar">
    <div class="container-fluid">
      <button class="btn btn-dark" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample"><i class="bi bi-list"></i>
        </button>
        <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
          <div class="offcanvas-header text-center">
            <h5 class="offcanvas-title w-100" id="offcanvasExampleLabel"><em>PiggyWearIoT.</em></h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body d-flex justify-content-center">
            <ul class="navbar-nav w-75 text-left">
                <li class="nav-item px-3">
                  <a class="nav-link" href="#">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house-door" viewBox="0 0 16 16">
                      <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146ZM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5Z"/>
                    </svg>
                    Home
                  </a>
                </li>
                <li class="nav-item px-3">
                  <a class="nav-link" href="/pigs">
                    <img src="/images/Pig Icon.png" alt="Icon" style="width: 24px; height: 24px;">
                    Pigs
                  </a>
                </li>
                <li class="nav-item px-3">
                  <a class="nav-link" href="/devices">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-calculator-fill" viewBox="0 0 16 16">
                      <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm2 .5v2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-7a.5.5 0 0 0-.5.5zm0 4v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM4.5 9a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM4 12.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zM7.5 6a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM7 9.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM10 6.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5zm.5 2.5a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 0-.5-.5h-1z"/>
                    </svg>
                    Device
                  </a>
                </li>
            </ul>
            <div class="position-absolute bottom-0 p-3">
              <img src="/images/Pig and Farm Vector.jpg" class="img-fluid rounded-4 " alt="">
            <button type="button" class="btn btn-success w-100 mt-4" data-bs-toggle="modal" data-bs-target="#addpig">Add Pig</button>
              </div>
          </div>
          
        </div>
      <p class="h3 ms-3"><b>Pigs</b></p>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div class="input-group">
            
                
            
                <select class ="form-select" onchange="handleLogout(this)">
                  <option value="" selected><%= fullName %></option>
                  <option value="/logout?_method=DELETE">Log Out</option>
                </select>
                <script>
                  function handleLogout(selectElement) {
                    var optionValue = selectElement.value;
                    
                    if (optionValue) {
                      var form = document.createElement('form');
                      form.action = optionValue;
                      form.method = 'POST';
                  
                      var button = document.createElement('button');
                      button.type = 'submit';
                      button.innerText = 'Log Out';
                  
                      form.appendChild(button);
                      document.body.appendChild(form);
                  
                      form.submit();
                    }
                  }
                  </script>
              </div>
             
      </div>
    </div>
    </nav>
          <section class="p-4 my-container">
            <div class="container-fluid w-100" style="background-color: #dfffd7;">
              <div class="row flex-wrap-equal">
                <div class="col-md-6">
                  <div id="bgswap" class="card horizontal rounded-4 cough-data <%= formattedCounts.today.coughs > 0 ? 'bg-warning' : 'bg-success' %>" style="color: white !important;">
                      
                    
                    <div class="container">
                      <div class =" row justify-content-center align-items-center">
                        <div class="col-md-6 ">
                          <img src="/images/Pig.jpg" class="img-fluid w-75  rounded-4 my-3" alt="...">
                        </div>
                        <div class="col-md-6">
                          <div class="card-body m-1">
                            <p class="card-text card-text-left fs-5 text-white">Label: <b><%= pigData.pig_name %></b></p>
                            <p class="card-text card-text-left fs-5 text-white">Device Code: <b><%= pigData.device_code %></b></p>
                            <p class="card-text card-text-left fs-5 text-white">Last cough: <b id="lastcough"></b></p>
                            <form action="/delete/<%= pigData.pig_id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this profile?');">
                              <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                      <div class="col-sm-5 col-md-4 col-lg-6">
                        <P id="today2" class="h4 text-center"><b>Today</b></P>
                        <P id="week2" class="h4 text-center"><b>This Week</b></P>
                        <P id="month2" class="h4 text-center"><b>Month of <%= new Date().toLocaleString('en-US', { month: 'long' }) %></b></P>
                        <P id="year2" class="h4 text-center"><b>Year of <%= new Date().getFullYear() %></b></P>
                      </div>
                      <div class="col-sm-7 col-md-8 col-lg-6">
                        <select id="table-select" class="form-select w-50 mx-auto">
                          <option value="daily">Daily</option>
                          <option value="weekly">Weekly</option>
                          <option value="monthly">Monthly</option>
                          <option value="yearly">Yearly</option>
                        </select>
                      </div>
                    </div>
                     <div class="row ">
                        <div class="col rounded-4" style="background-color: white; color: black;">
                          <p class="text-center mt-3" style="font-family: arial narrow; font-size: 26px;">Total Cough Data</p>
                          
                          <div class="row">
                            <div id="daily" class="col">
                            </div>
                          </div>
                          <div class="row">
                            <div id="weekly" class="col">
                            </div>              
                          </div>
                          <div class="row">
                            <div id="monthly" class="col">
                            </div>
                          </div>
                          <div class="row">
                            <div id="yearly" class="col">
                            </div>
                          </div>

                        </div>
                     </div> 
                </div>
              </div>
              <div class="row mt-3 text-center">
                  <h6 class="h5 w-100"><b>Cough History</b></h6>
                  <div class="row  rounded-4 table-responsive" style="background-color: white;">
                    <table class="table table-striped  align-middle ">
                      <thead >
                        <tr>
                          <th>Cough ID</th>
                          <th>Day</th>
                          <th>Date</th>
                          <th>Time</th>
                          <th>Accuracy (%)</th>
                        </tr>
                      </thead>
                      <tbody id="coughEventsTable">
                        
                      </tbody>
                    </table>
                    <div class="pagination">
                      <% if (currentPage > 1) { %>
                        <a href="/individualPig/<%= pigId %>?page=<%= currentPage - 1 %>" class="prev">&laquo; Previous</a>
                      <% } %>
                      
                      <% if (coughEvents.length === PAGE_SIZE) { %>
                        <a href="/individualPig/<%= pigId %>?page=<%= currentPage + 1 %>" class="next">Next &raquo;</a>
                      <% } %>
                    </div>
                  </div>
              </div>
          </div>  
    </section>

    <div class="modal" id="addpig">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header text-center bg-success">
                  <h5 class="modal-title w-100 text-white">Add a Pig</h5>
                  
              </div>  
              <div class="modal-body">
                  <form id = "addPigForm" action="/submit" method="POST">
                      <div class="mb-3">
                        <label for="name">Name:</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                      </div>
                      <div class="mb-3">
                        <label for="device">Device:</label>
                        <select id="device" class="form-control"name="device" required>
                            <% devices.forEach(function(device) { %>
                        <option value="<%= device.device_code %>"><%= device.name %>-<%= device.device_code %></option>
                            <% }) %>
                      </select>
                      </div>
                       
                        <div class="modal-footer">
                          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                          <button type="submit" class="btn btn-success" onclick="validateAndConfirm()" >Confirm</button>
                      </div>
                  </form>
              </div>
              
          </div>
      </div>
  </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

</body>
<script src="/socket.io/socket.io.js"></script>
<script>
  // Extract the pigId from the data attribute
// Extract the pigId from the template
const pigId = '<%= pigId %>';

// Connect to the Socket.IO server with the pigId as a query parameter
const socket = io.connect('/', { query: { pigId: pigId } });
  
  // Handle the initial data when the client receives it
  socket.on('oldData', (formattedCounts, lastCoughEvent) => {
    // Update the initial data in the DOM
    updateCountsInDOM(formattedCounts, lastCoughEvent);
  });

  // Handle the updated data when the client receives it
  socket.on('newData', (formattedCounts, lastCoughEvent) => {
    // Update the updated data in the DOM
    updateCountsInDOM(formattedCounts, lastCoughEvent);
  });

  // Function to update the data in the DOM
  function updateCountsInDOM(formattedCounts, lastCoughEvent) {
    // Update the DOM elements with the new counts
   
  // Access the 'coughs' property and perform necessary operations

    document.getElementById('daily').innerHTML = `<p class="h1 text-center"><b>${formattedCounts.today.coughs}</b></p>
      <p class="h4 text-center">Coughs</p>`;
    document.getElementById('weekly').innerHTML = `<p class="h1 text-center"><b>${formattedCounts.thisWeek.coughs}</b></p>
      <p class="h4 text-center">Coughs</p>`;
    document.getElementById('monthly').innerHTML = `<p class="h1 text-center"><b>${formattedCounts.thisMonth.coughs}</b></p>
      <p class="h4 text-center">Coughs</p>`;
    document.getElementById('yearly').innerHTML = `<p class="h1 text-center"><b>${formattedCounts.thisYear.coughs}</b></p>
      <p class="h4 text-center">Coughs</p>`;

    if (lastCoughEvent) {
      document.getElementById('lastcough').innerText = lastCoughEvent.date_time;
    } else {
      document.getElementById('lastcough').innerText = 'No cough events found.';
    }

    // Update the cough history table
    const coughEventsTable = document.getElementById('coughEventsTable');
    coughEventsTable.innerHTML = ''; // Clear the existing table

    formattedCounts.coughEvents.forEach((event) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${event.cough_id}</td>
        <td>${event.week}</td>
        <td>${event.date}</td>
        <td>${event.time}</td>
        <td>${event.accuracy}</td>
      `;
      coughEventsTable.appendChild(row);
    });
const coughDataElement = document.querySelector('.cough-data');

if (formattedCounts.today.coughs > 0) {
  coughDataElement.classList.remove('bg-success');
  coughDataElement.classList.add('bg-warning');
} else {
  coughDataElement.classList.remove('bg-warning');
  coughDataElement.classList.add('bg-success');
}

}

</script>


  <script>
    function validateAndConfirm() {
    var input1 = document.getElementById('pig_name').value;
    var input2 = document.getElementById('device_code').value;
    
    if (input1.trim() === '' || input2.trim() === '') {
      alert('Please fill out all fields.');
      return;
    }
    
    var confirmed = confirm("Are you sure you want to confirm?");
    if (confirmed) {
    
      document.getElementById('addPigForm').submit();
      alert("Pig added successfully");
    }
  }


    const select = document.getElementById("table-select");
    const daily = document.getElementById("daily");
    const weekly = document.getElementById("weekly");
    const monthly = document.getElementById("monthly");
    const yearly = document.getElementById("yearly");

    // Show the selected table, hide others
    select.addEventListener("change", () => {
      const selected = select.value;
      if (selected === "daily") {
        daily.style.display = "block";
        weekly.style.display = "none";
        monthly.style.display = "none";
        yearly.style.display = "none";
        today2.style.display = "block";
        week2.style.display = "none";
        month2.style.display = "none";
        year2.style.display = "none";
      } else if (selected === "weekly") {
        daily.style.display = "none";
        weekly.style.display = "block";
        monthly.style.display = "none";
        yearly.style.display = "none";
        today2.style.display = "none";
        week2.style.display = "block";
        month2.style.display = "none";
        year2.style.display = "none";
      } else if (selected === "monthly") {
        daily.style.display = "none";
        weekly.style.display = "none";
        monthly.style.display = "block";
        yearly.style.display = "none";
        today2.style.display = "none";
        week2.style.display = "none";
        month2.style.display = "block";
        year2.style.display = "none";
      } else if (selected === "yearly") {
        daily.style.display = "none";
        weekly.style.display = "none";
        monthly.style.display = "none";
        yearly.style.display = "block";
        today2.style.display = "none";
        week2.style.display = "none";
        month2.style.display = "none";
        year2.style.display = "block";
      }
    });
  </script>
  
</html>